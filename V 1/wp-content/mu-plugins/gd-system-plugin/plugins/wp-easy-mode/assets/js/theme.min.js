window.WPEM=window.WPEM||{},jQuery(document).ready(function(a){function b(b,d){a.ajax({type:"GET",url:"//api.wordpress.org/themes/info/1.1/",dataType:"jsonp",data:{action:"theme_information",request:{slug:d}},success:function(a){wpem_theme_vars.themes[b]=a,c(a,b)}})}function c(b,c){var f=a("#wpem-template-theme"),g=a(".theme-browser .themes"),h="undefined"!=typeof b.slug?b.slug:"",i="undefined"!=typeof b.name?b.name:"",j="undefined"!=typeof b.author?b.author:"",k="undefined"!=typeof b.screenshot_url?b.screenshot_url:"",l=a(a.trim(f.clone().html()));a(l).appendTo(g),l.addClass(h),l.attr("data-theme",h),k?l.find(".theme-screenshot img").attr("src",k):(l.find(".theme-screenshot").addClass("blank"),l.find(".theme-screenshot img").remove()),l.find(".theme-author span").text(j),l.find(".theme-name").text(i),l.on("click",".theme-actions a",function(b){b.preventDefault();var c=a(this).closest(".theme");return d(c),!1}),l.on("click",function(){e(b,c)})}function d(b){a("#wpem_selected_theme").val(b.data("theme")),b.removeClass("hover").addClass("active");var c=a(".wpem-screen");c.find("form").submit()}function e(b,c){var h=a("#wpem-template-theme-preview"),i=a(".wrap"),j=a("#wpem-template-header-images"),k=a(a.trim(h.clone().html())),l=k.find("#wpem-header-images-wrapper"),m="undefined"!=typeof b.slug?b.slug:"",n="undefined"!=typeof b.name?b.name:"",o="undefined"!=typeof b.author?b.author:"",p="undefined"!=typeof b.version?b.version:"",q=wpem_theme_vars.preview_url+"&theme="+b.slug,r="undefined"!=typeof b.screenshot_url?b.screenshot_url:"",s="undefined"!=typeof b.sections.description?b.sections.description:"";l.html(j.html());var t=l.find("li.selected a").data("image-url"),u=a("#wpem_selected_header_image_url");"undefined"!=typeof t&&(q+="&header_image="+encodeURIComponent(t),u.val(t)),a(k).appendTo(i).show(),k.find(".theme-name").text(n),k.find(".theme-by span").text(o),k.find(".theme-screenshot").attr("src",r),k.find(".theme-version span").text(p);var v=l.is(":empty")?s:g(s,140,"&nbsp;&hellip;");k.find(".theme-description").html(v),f();var w=k.find(".wp-full-overlay-main");w.append("<iframe>"),w.find("iframe").attr("src",q),k.on("click","a.previous-theme",function(a){a.preventDefault(),c=0===c?wpem_theme_vars.themes.length-1:c-1;var b=wpem_theme_vars.themes[c];k.remove(),e(b,c)}),k.on("click","a.next-theme",function(a){a.preventDefault(),c=wpem_theme_vars.themes.length-1===c?0:c+1,k.remove();var b=wpem_theme_vars.themes[c];e(b,c)}),k.on("click","a.theme-install",function(b){b.preventDefault();var c=a(".theme."+m);k.find("a.close-full-overlay").click(),d(c)}),k.on("click","a.close-full-overlay",function(a){a.preventDefault(),k.remove()}),k.on("click",".wpem-header-images-list li a",function(b){b.preventDefault();var c=a(this),d=c.parent(),e=encodeURIComponent(c.data("image-url")),f="",g=a(".wp-full-overlay-main iframe");!d.hasClass("selected")&&d.siblings(".selected").length>0&&(f=encodeURIComponent(d.siblings(".selected").find("a").data("image-url")),d.siblings().removeClass("selected")),d.toggleClass("selected"),j.html(l.html());var h=g.attr("src");d.hasClass("selected")?h=""===f?h+"&header_image="+e:h.replace(f,e):(h=h.replace("&header_image="+e,""),e=""),u.val(decodeURIComponent(e)),g.on("load",function(){g.css("opacity",1),g.off("load")}),g.css("opacity",0),g.attr("src",h)});var x=a(".theme-install-overlay"),y=x.find(".devices button");a("button.collapse-sidebar").on("click",function(){return"true"===a(this).attr("aria-expanded")?(window.WPEM.Pointers.hideAll(),a(this).attr({"aria-expanded":"false","aria-label":wpem_theme_vars.i18n.expand}),y.hide()):(setTimeout(function(){f(),y.show()},200),a(this).attr({"aria-expanded":"true","aria-label":wpem_theme_vars.i18n.collapse})),a(this).toggleClass("collapsed").toggleClass("expanded"),a(".wp-full-overlay").toggleClass("collapsed").toggleClass("expanded"),!1}),y.on("click",function(b){var c=a(b.currentTarget).data("device");x.removeClass("preview-desktop preview-tablet preview-mobile").addClass("preview-"+c).data("current-preview-device",c);var d=a(".wp-full-overlay-footer .devices");d.find("button").removeClass("active").attr("aria-pressed",!1),d.find("button.preview-"+c).addClass("active").attr("aria-pressed",!0)})}function f(){window.WPEM.Pointers.openFirstInRange("wpem_theme_preview_",[1,2,3])}function g(a,b,c){if(a.length<=b)return a;for(var d=a.split(" "),e=d[0].length,f=1;f<d.length&&!(e===b||e+d[f].length+1>b);f++)e+=d[f].length+1;return d.slice(0,f).join(" ")+(c||"")}a(document).on("mouseenter",".theme",function(){a(".theme").removeClass("hover")}),a(document).on("keyup",function(b){9===b.keyCode&&(a(".theme").removeClass("hover"),a("a.preview-theme:focus").closest(".theme").addClass("hover"))}),a(document).on("keydown",function(b){switch(b.keyCode){case 27:a("a.close-full-overlay").click();break;case 37:a("a.previous-theme").click();break;case 39:a("a.next-theme").click()}}),a.each(wpem_theme_vars.themes,function(a,c){b(a,c)})});